<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Fuel Express - Customer Dashboard</title>
	<!-- Leaflet CSS for maps -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
	<!-- Google Maps API -->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCyIruC1n1datcCsvGT7syLkTOO8E_n5zA"></script>
	<style>
		:root {
			--primary: #2c3e50;
			--secondary: #3498db;
			--accent: #2ecc71;
			--danger: #e74c3c;
			--warning: #f39c12;
			--border-radius: 8px;
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}

		body {
			background-color: #f5f7fa;
			color: #333;
			line-height: 1.6;
		}

		/* Dashboard Layout */
		.dashboard-container {
			display: flex;
			min-height: 100vh;
		}

		/* Sidebar Styles */
		.sidebar {
			width: 250px;
			background: linear-gradient(180deg, #2c3e50, #1a252f);
			color: white;
			padding: 20px 0;
			position: fixed;
			height: 100vh;
			overflow-y: auto;
			z-index: 100;
			transition: transform 0.3s ease;
		}

		.sidebar-header {
			padding: 0 20px 20px;
			border-bottom: 1px solid rgba(255, 255, 255, 0.1);
		}

		.sidebar-header h3 {
			font-size: 24px;
			font-weight: 700;
			background: linear-gradient(45deg, #3498db, #2ecc71);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
		}

		.sidebar-menu {
			list-style: none;
			padding: 20px 0;
		}

		.sidebar-menu li {
			margin-bottom: 5px;
		}

		.sidebar-menu a {
			display: flex;
			align-items: center;
			padding: 12px 20px;
			color: rgba(255, 255, 255, 0.8);
			text-decoration: none;
			transition: all 0.3s;
			border-left: 3px solid transparent;
		}

		.sidebar-menu a:hover {
			background: rgba(255, 255, 255, 0.1);
			color: white;
			border-left-color: var(--accent);
		}

		.sidebar-menu a.active {
			background: rgba(52, 152, 219, 0.2);
			color: white;
			border-left-color: var(--secondary);
		}

		.sidebar-menu i {
			width: 25px;
			font-size: 16px;
			margin-right: 10px;
		}

		.notification-count {
			background: var(--accent);
			color: white;
			font-size: 12px;
			padding: 2px 8px;
			border-radius: 10px;
			margin-left: auto;
		}

		/* Main Content */
		.main-content {
			flex: 1;
			margin-left: 250px;
			transition: margin-left 0.3s ease;
		}

		/* Topbar */
		.topbar {
			background: white;
			padding: 15px 30px;
			display: flex;
			align-items: center;
			justify-content: space-between;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			position: sticky;
			top: 0;
			z-index: 99;
		}

		.toggle-sidebar {
			background: none;
			border: none;
			font-size: 20px;
			color: var(--primary);
			cursor: pointer;
			display: none;
		}

		.logo {
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.logo-icon {
			width: 40px;
			height: 40px;
			background: linear-gradient(45deg, var(--secondary), var(--accent));
			border-radius: 8px;
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
			font-size: 20px;
		}

		.logo h1 {
			font-size: 20px;
			color: var(--primary);
		}

		.user-info {
			display: flex;
			align-items: center;
			gap: 15px;
		}

		.user-avatar {
			width: 40px;
			height: 40px;
			background: linear-gradient(45deg, var(--secondary), var(--accent));
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
			font-weight: 600;
			font-size: 16px;
		}

		.notifications {
			position: relative;
			cursor: pointer;
			font-size: 20px;
			color: var(--primary);
		}

		/* Page Header */
		.page-header {
			padding: 30px;
			background: white;
			margin-bottom: 20px;
		}

		.page-title h2 {
			color: var(--primary);
			font-size: 28px;
			margin-bottom: 5px;
		}

		.page-subtitle {
			color: #7f8c8d;
			font-size: 14px;
		}

		.breadcrumb {
			margin-top: 10px;
			font-size: 14px;
			color: #7f8c8d;
		}

		.breadcrumb a {
			color: var(--secondary);
			text-decoration: none;
		}

		.breadcrumb i {
			margin: 0 10px;
		}

		/* Forms */
		.registration-section {
			background: white;
			border-radius: var(--border-radius);
			padding: 30px;
			margin: 0 30px 30px;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
		}

		.section-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 25px;
			padding-bottom: 15px;
			border-bottom: 2px solid #f1f1f1;
		}

		.section-title {
			color: var(--primary);
			font-size: 22px;
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.form-group {
			margin-bottom: 25px;
		}

		.form-group label {
			display: block;
			margin-bottom: 8px;
			font-weight: 600;
			color: var(--primary);
		}

		.form-group label.required::after {
			content: " *";
			color: var(--danger);
		}

		.form-group input,
		.form-group select,
		.form-group textarea {
			width: 100%;
			padding: 12px 15px;
			border: 1px solid #ddd;
			border-radius: 6px;
			font-size: 16px;
			transition: all 0.3s;
		}

		.form-group input:focus,
		.form-group select:focus,
		.form-group textarea:focus {
			outline: none;
			border-color: var(--secondary);
			box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
		}

		.form-tip {
			margin-top: 8px;
			font-size: 13px;
			color: #7f8c8d;
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.form-row {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 20px;
		}

		/* Buttons */
		.btn {
			padding: 12px 24px;
			border: none;
			border-radius: 6px;
			font-size: 16px;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.3s;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			gap: 8px;
		}

		.btn-submit {
			background: linear-gradient(45deg, var(--accent), #27ae60);
			color: white;
		}

		.btn-submit:hover {
			transform: translateY(-2px);
			box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
		}

		.btn-reset {
			background: #ecf0f1;
			color: var(--primary);
		}

		.btn-reset:hover {
			background: #d5dbdb;
		}

		.button-group {
			display: flex;
			gap: 15px;
			justify-content: flex-end;
		}

		/* Fuel Selector */
		.fuel-selector {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
			gap: 15px;
			margin-top: 10px;
		}

		.fuel-option {
			border: 2px solid #e0e0e0;
			border-radius: 8px;
			padding: 15px;
			text-align: center;
			cursor: pointer;
			transition: all 0.3s;
			background: white;
		}

		.fuel-option:hover {
			border-color: var(--secondary);
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
		}

		.fuel-option.selected {
			border-color: var(--accent);
			background: rgba(46, 204, 113, 0.05);
		}

		.fuel-icon {
			font-size: 24px;
			margin-bottom: 10px;
			color: var(--secondary);
		}

		.fuel-name {
			font-weight: 600;
			margin-bottom: 5px;
			color: var(--primary);
		}

		.fuel-price {
			font-size: 18px;
			font-weight: 700;
			color: var(--accent);
			margin-bottom: 5px;
		}

		/* Pump Cards */
		.pump-cards {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
			gap: 20px;
			margin-top: 20px;
		}

		.pump-card {
			border: 1px solid #e0e0e0;
			border-radius: 8px;
			padding: 20px;
			background: white;
			transition: all 0.3s;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		}

		.pump-card:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
		}

		.pump-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 15px;
		}

		.pump-name {
			font-size: 18px;
			font-weight: 600;
			color: var(--primary);
		}

		.pump-distance {
			background: var(--accent);
			color: white;
			padding: 4px 12px;
			border-radius: 20px;
			font-size: 14px;
		}

		.pump-details {
			margin-bottom: 15px;
		}

		.pump-detail {
			display: flex;
			align-items: center;
			gap: 10px;
			margin-bottom: 8px;
			color: #666;
			font-size: 14px;
		}

		.pump-detail i {
			color: var(--secondary);
			width: 16px;
		}

		.pump-price {
			font-size: 16px;
			font-weight: 600;
			color: var(--primary);
			margin-bottom: 10px;
		}

		/* Modal */
		.modal-overlay {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0, 0, 0, 0.5);
			z-index: 1000;
			align-items: center;
			justify-content: center;
		}

		.modal-overlay.active {
			display: flex;
		}

		.booking-modal {
			background: white;
			border-radius: 12px;
			width: 90%;
			max-width: 600px;
			max-height: 90vh;
			overflow-y: auto;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
		}

		/* Status Badges */
		.status-badge {
			padding: 4px 12px;
			border-radius: 20px;
			font-size: 12px;
			font-weight: 600;
			text-transform: uppercase;
		}

		.status-pending {
			background: #fff3cd;
			color: #856404;
		}

		.status-confirmed {
			background: #d1ecf1;
			color: #0c5460;
		}

		.status-delivered {
			background: #d4edda;
			color: #155724;
		}

		.status-cancelled {
			background: #f8d7da;
			color: #721c24;
		}

		/* Map Styles */
		#map-container {
			position: relative;
			height: 400px;
			border-radius: 8px;
			overflow: hidden;
			margin-bottom: 20px;
		}

		#map {
			height: 100%;
			width: 100%;
		}

		.coordinates-display {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 15px;
		}

		.coordinate-box {
			background: #f8f9fa;
			padding: 15px;
			border-radius: 6px;
			border-left: 4px solid var(--secondary);
		}

		.coordinate-label {
			font-size: 12px;
			color: #7f8c8d;
			margin-bottom: 5px;
		}

		.coordinate-value {
			font-size: 18px;
			font-weight: 600;
			color: var(--primary);
		}

		/* Spinner */
		.spinner {
			border: 4px solid #f3f3f3;
			border-top: 4px solid #3498db;
			border-radius: 50%;
			width: 50px;
			height: 50px;
			animation: spin 1s linear infinite;
			margin: 30px auto;
		}

		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}

		/* Footer */
		.footer {
			text-align: center;
			padding: 20px;
			color: #7f8c8d;
			font-size: 14px;
			border-top: 1px solid #eee;
			margin-top: 30px;
		}

		/* Responsive */
		@media (max-width: 768px) {
			.sidebar {
				transform: translateX(-100%);
			}

			.sidebar.active {
				transform: translateX(0);
			}

			.main-content {
				margin-left: 0;
			}

			.main-content.expanded {
				margin-left: 250px;
			}

			.toggle-sidebar {
				display: block;
			}

			.form-row {
				grid-template-columns: 1fr;
			}

			.coordinates-display {
				grid-template-columns: 1fr;
			}

			.fuel-selector {
				grid-template-columns: 1fr 1fr;
			}

			.pump-cards {
				grid-template-columns: 1fr;
			}
		}

		.sidebar-overlay {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0, 0, 0, 0.5);
			z-index: 99;
		}

		.sidebar-overlay.active {
			display: block;
		}
	</style>
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
	<!-- Sidebar Overlay for Mobile -->
	<div class="sidebar-overlay" id="sidebarOverlay"></div>

	<!-- Dashboard Container -->
	<div class="dashboard-container">
		<!-- Sidebar -->
		<aside class="sidebar" id="sidebar">
			<div class="sidebar-header">
				<h3>Fuel Express</h3>
				<p style="font-size: 14px; margin-top: 5px; color: #bdc3c7;">Customer Portal</p>
			</div>

			<ul class="sidebar-menu">
				<li>
					<a href="#" class="active" id="dashboardLink">
						<i class="fas fa-tachometer-alt"></i>
						<span>Dashboard</span>
					</a>
				</li>
				<li>
					<a href="#" id="bookFuelLink">
						<i class="fas fa-gas-pump"></i>
						<span>Book Fuel</span>
					</a>
				</li>
				<li>
					<a href="#" id="myOrdersLink">
						<i class="fas fa-shopping-cart"></i>
						<span>My Orders</span>
						<span class="notification-count" id="orderCount"
							th:text="${customer?.orders?.[0]?.size() ?: 0}">0</span>
					</a>
				</li>
				<li>
					<a href="#" id="nearbyPumpsLink">
						<i class="fas fa-map-marker-alt"></i>
						<span>Nearby Pumps</span>
					</a>
				</li>
				<li>
					<a href="#" id="profileLink">
						<i class="fas fa-user"></i>
						<span>Profile</span>
					</a>
				</li>
				<li>
					<a href="#" id="notificationsLink">
						<i class="fas fa-bell"></i>
						<span>Notifications</span>
						<span class="notification-count">3</span>
					</a>
				</li>
				<li>
					<a href="#" id="helpLink">
						<i class="fas fa-question-circle"></i>
						<span>Help & Support</span>
					</a>
				</li>
			</ul>

			<div class="sidebar-footer">
				<p>Customer ID: <span th:text="${customer?.id}">12345</span></p>
				<p>v2.1.0</p>
			</div>
		</aside>

		<!-- Main Content -->
		<main class="main-content" id="mainContent">
			<!-- Topbar -->
			<div class="topbar">
				<button class="toggle-sidebar" id="toggleSidebar">
					<i class="fas fa-bars"></i>
				</button>

				<div class="logo">
					<div class="logo-icon">
						<i class="fas fa-gas-pump"></i>
					</div>
					<div>
						<h1>Fuel Express</h1>
						<div style="font-size: 12px; color: #7f8c8d; margin-top: -3px;">Customer Dashboard</div>
					</div>
				</div>

				<div class="user-info">
					<div class="notifications" id="notifications">
						<i class="fas fa-bell"></i>
						<span class="notification-count">3</span>
					</div>
					<div class="user-avatar" id="userMenu">
						<span th:text="${customer?.name?.substring(0, 2)?.toUpperCase()}">CU</span>
					</div>
					<div class="user-details">
						<div class="user-name" th:text="${customer?.name}">Customer Name</div>
						<div class="user-role">Premium Customer</div>
					</div>
				</div>
			</div>

			<!-- Dashboard Content -->
			<div class="page-header">
				<div class="page-title">
					<h2>Welcome, <span th:text="${customer?.name}">Customer</span>!</h2>
					<div class="page-subtitle">Book fuel delivery from nearby petrol pumps within 20km radius</div>
				</div>

				<div class="breadcrumb">
					<a href="#">Dashboard</a>
					<i class="fas fa-chevron-right"></i>
					<span>Book Fuel</span>
				</div>
			</div>

			<!-- Book Fuel Section -->
			<div class="registration-section" id="bookFuelSection">
				<div class="section-header">
					<h3 class="section-title">
						<i class="fas fa-gas-pump"></i> Book Fuel Delivery
					</h3>
				</div>

				<!-- Location Detection -->
				<div class="form-group">
					<label>Your Current Location</label>
					<div style="display: flex; gap: 15px; align-items: center;">
						<input type="text" id="locationDisplay" placeholder="Click to detect your location" readonly
							style="flex: 1; background: #f8f9fa;">
						<button class="btn" id="detectLocation"
							style="background: var(--secondary); color: white; padding: 12px 20px;">
							<i class="fas fa-location-crosshairs"></i> Detect Location
						</button>
						<button class="btn" id="useDefaultLocation"
							style="background: #6c757d; color: white; padding: 12px 20px;">
							<i class="fas fa-map-marker-alt"></i> Use Default
						</button>
					</div>
					<div class="form-tip">
						<i class="fas fa-lightbulb"></i>
						We'll search for petrol pumps within 20km of your location
					</div>
					<input type="hidden" id="userLat" th:value="${defaultLat}">
					<input type="hidden" id="userLng" th:value="${defaultLng}">
				</div>

				<!-- Fuel Type Selection -->
				<div class="form-group">
					<label class="required">Select Fuel Type</label>
					<div class="fuel-selector" id="fuelSelector">
						<div class="fuel-option" data-type="Petrol">
							<div class="fuel-icon">
								<i class="fas fa-gas-pump"></i>
							</div>
							<div class="fuel-name">Petrol</div>
							<div class="fuel-price">₹ <span id="petrolPrice">96.72</span>/L</div>
							<div style="font-size: 12px; color: #7f8c8d;">Regular</div>
						</div>

						<div class="fuel-option" data-type="Diesel">
							<div class="fuel-icon">
								<i class="fas fa-oil-can"></i>
							</div>
							<div class="fuel-name">Diesel</div>
							<div class="fuel-price">₹ <span id="dieselPrice">89.62</span>/L</div>
							<div style="font-size: 12px; color: #7f8c8d;">Regular</div>
						</div>

						<div class="fuel-option" data-type="CNG">
							<div class="fuel-icon">
								<i class="fas fa-fire"></i>
							</div>
							<div class="fuel-name">CNG</div>
							<div class="fuel-price">₹ <span id="cngPrice">78.50</span>/kg</div>
							<div style="font-size: 12px; color: #7f8c8d;">Compressed</div>
						</div>

						<div class="fuel-option" data-type="Premium Petrol">
							<div class="fuel-icon">
								<i class="fas fa-crown"></i>
							</div>
							<div class="fuel-name">Premium Petrol</div>
							<div class="fuel-price">₹ <span id="premiumPetrolPrice">105.30</span>/L</div>
							<div style="font-size: 12px; color: #7f8c8d;">High Octane</div>
						</div>
					</div>
				</div>

				<!-- Quantity Selection -->
				<div class="form-group">
					<label class="required">Quantity</label>
					<div style="display: flex; gap: 20px; align-items: center;">
						<div style="flex: 1;">
							<input type="range" id="quantitySlider" min="1" max="50" value="10"
								style="width: 100%; margin: 15px 0;">
							<div style="display: flex; justify-content: space-between;">
								<span>1L</span>
								<span>25L</span>
								<span>50L</span>
							</div>
						</div>
						<div style="width: 200px;">
							<div style="text-align: center;">
								<div style="font-size: 14px; color: #7f8c8d;">Selected Quantity</div>
								<div style="font-size: 32px; font-weight: 700; color: var(--primary);">
									<span id="quantityValue">10</span>L
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Delivery Details -->
				<div class="form-row">
					<div class="form-group">
						<label for="vehicleNumber" class="required">Vehicle Number</label>
						<input type="text" id="vehicleNumber" placeholder="e.g., MH01AB1234" required>
					</div>

					<div class="form-group">
						<label for="deliveryTime" class="required">Preferred Delivery Time</label>
						<select id="deliveryTime" required>
							<option value="">Select Time Slot</option>
							<option value="ASAP">As Soon As Possible</option>
							<option value="9-11">9:00 AM - 11:00 AM</option>
							<option value="11-1">11:00 AM - 1:00 PM</option>
							<option value="1-3">1:00 PM - 3:00 PM</option>
							<option value="3-5">3:00 PM - 5:00 PM</option>
							<option value="5-7">5:00 PM - 7:00 PM</option>
						</select>
					</div>
				</div>

				<div class="form-group">
					<label for="deliveryAddress" class="required">Delivery Address</label>
					<textarea id="deliveryAddress" rows="3" placeholder="Enter complete delivery address"
						required></textarea>
					<div class="form-tip">
						<i class="fas fa-lightbulb"></i>
						You can use your current location or enter a different delivery address
					</div>
				</div>

				<!-- Payment Method -->
				<div class="form-group">
					<label class="required">Payment Method</label>
					<div style="display: flex; gap: 15px;">
						<label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
							<input type="radio" name="payment" value="online" checked>
							<i class="fas fa-credit-card"></i> Online Payment
						</label>
						<label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
							<input type="radio" name="payment" value="cod">
							<i class="fas fa-money-bill-wave"></i> Cash on Delivery
						</label>
						<label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
							<input type="radio" name="payment" value="wallet">
							<i class="fas fa-wallet"></i> Fuel Express Wallet
						</label>
					</div>
				</div>

				<!-- Estimated Cost -->
				<div class="form-notice" style="background: #e8f4fc; border-left-color: var(--secondary);">
					<div style="display: flex; justify-content: space-between; align-items: center;">
						<div>
							<i class="fas fa-calculator"></i>
							<strong>Estimated Cost:</strong>
							₹<span id="estimatedCost" style="font-size: 24px; font-weight: 700;">0.00</span>
							<span style="color: #7f8c8d; margin-left: 10px;">(Including all charges)</span>
						</div>
						<button class="btn" id="findPumpsBtn" style="background: var(--accent); color: white;">
							<i class="fas fa-search"></i> Find Nearby Pumps
						</button>
					</div>
				</div>

				<!-- Search Results -->
				<div id="searchResults" style="display: none; margin-top: 30px;">
					<div class="section-header">
						<h3 class="section-title">
							<i class="fas fa-map-marker-alt"></i> Nearby Petrol Pumps (Within 20km)
						</h3>
					</div>

					<div id="resultsLoading" class="spinner" style="display: none;"></div>

					<div class="pump-cards" id="pumpCards">
						<!-- Pump cards will be dynamically inserted here -->
					</div>

					<div id="noResults"
						style="display: none; text-align: center; padding: 40px; background: #f8f9fa; border-radius: 8px;">
						<i class="fas fa-exclamation-triangle"
							style="font-size: 48px; color: #f39c12; margin-bottom: 20px;"></i>
						<h3 style="color: #7f8c8d; margin-bottom: 10px;">No pumps found nearby</h3>
						<p>Try expanding your search radius or check back later.</p>
					</div>
				</div>
			</div>

			<!-- Interactive Map Section -->
			<div class="registration-section" style="margin-top: 30px;">
				<div class="section-header">
					<h3 class="section-title">
						<i class="fas fa-map"></i> Interactive Map
					</h3>
				</div>

				<div id="map-container">
					<div id="map"></div>
					<div
						style="position: absolute; top: 10px; right: 10px; z-index: 1000; background: white; padding: 8px 12px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); font-size: 14px;">
						<i class="fas fa-crosshairs"></i> Your location is marked in blue
					</div>
				</div>

				<div class="coordinates-display">
					<div class="coordinate-box">
						<div class="coordinate-label">Your Latitude</div>
						<div class="coordinate-value" id="userLatDisplay" th:text="${defaultLat}">19.0760</div>
					</div>
					<div class="coordinate-box">
						<div class="coordinate-label">Your Longitude</div>
						<div class="coordinate-value" id="userLngDisplay" th:text="${defaultLng}">72.8777</div>
					</div>
				</div>
			</div>

			<!-- Recent Orders -->
			<div class="registration-section" style="margin-top: 30px;" th:if="${customer?.orders?.size() > 0}">
				<div class="section-header">
					<h3 class="section-title">
						<i class="fas fa-history"></i> Recent Orders
					</h3>
				</div>

				<table style="width: 100%; border-collapse: collapse;">
					<thead>
						<tr style="background: #f8f9fa;">
							<th style="padding: 15px; text-align: left;">Order ID</th>
							<th style="padding: 15px; text-align: left;">Fuel Type</th>
							<th style="padding: 15px; text-align: left;">Quantity</th>
							<th style="padding: 15px; text-align: left;">Amount</th>
							<th style="padding: 15px; text-align: left;">Status</th>
							<th style="padding: 15px; text-align: left;">Date</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="order : ${customer?.orders}" style="border-bottom: 1px solid #eee;">
							<td style="padding: 15px;" th:text="${order.orderNumber}">FE-123456</td>
							<td style="padding: 15px;" th:text="${order.fuelType}">Petrol</td>
							<td style="padding: 15px;" th:text="${order.quantity} + 'L'">10L</td>
							<td style="padding: 15px;"
								th:text="'₹' + ${#numbers.formatDecimal(order.totalAmount, 1, 2)}">₹967.20</td>
							<td style="padding: 15px;">
								<span class="status-badge" th:classappend="'status-' + ${order.status?.toLowerCase()}"
									th:text="${order.status}">PENDING</span>
							</td>
							<td style="padding: 15px;" th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy')}">
								15/03/2024</td>
						</tr>
					</tbody>
				</table>
			</div>

			<!-- Footer -->
			<div class="footer">
				<p>Fuel Express &copy; 2023. All rights reserved. | 24x7 Support: 1800-123-4567</p>
				<p style="margin-top: 5px;">Average delivery time: 30-45 minutes | Free delivery above 10L</p>
			</div>
		</main>
	</div>

	<!-- Booking Modal -->
	<div class="modal-overlay" id="bookingModal">
		<div class="booking-modal">
			<div class="section-header" style="margin: 0; background: var(--primary); color: white;">
				<h3 class="section-title" style="color: white;">
					<i class="fas fa-check-circle"></i> Confirm Booking
				</h3>
			</div>

			<div style="padding: 25px;">
				<div id="bookingSummary">
					<!-- Booking summary will be dynamically inserted here -->
				</div>

				<div style="margin-top: 30px;">
					<h4 style="margin-bottom: 15px; color: var(--primary);">
						<i class="fas fa-shield-alt"></i> Secure Payment
					</h4>
					<div style="background: #f8f9fa; padding: 20px; border-radius: 6px;">
						<div id="paymentOptions">
							<!-- Payment options will be dynamically inserted here -->
						</div>
					</div>
				</div>

				<div class="button-group" style="margin-top: 30px;">
					<button class="btn btn-submit" id="confirmBooking">
						<i class="fas fa-lock"></i> Confirm & Pay
					</button>
					<button class="btn btn-reset" id="cancelBooking">
						<i class="fas fa-times"></i> Cancel
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Leaflet JS and GoogleMutant Plugin -->
	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
	<script src="https://unpkg.com/leaflet.gridlayer.googlemutant@latest/dist/Leaflet.GoogleMutant.js"></script>

	<script>
		// Initialize the map
		const defaultLat = 19.0760;
		const defaultLng = 72.8777;

		let map = L.map('map').setView([defaultLat, defaultLng], 13);
		let userMarker = null;
		let pumpMarkers = [];

		// Add Google Maps tile layer
		L.gridLayer.googleMutant({
			type: 'roadmap'
		}).addTo(map);

		// Add user marker
		userMarker = L.marker([defaultLat, defaultLng], {
			icon: L.divIcon({
				html: '<div style="background: #3498db; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.5);"></div>',
				iconSize: [26, 26]
			}),
			title: 'Your Location'
		}).addTo(map);

		// Update coordinates display
		function updateUserCoordinates(lat, lng) {
			document.getElementById('userLat').value = lat;
			document.getElementById('userLng').value = lng;
			document.getElementById('userLatDisplay').textContent = lat.toFixed(6);
			document.getElementById('userLngDisplay').textContent = lng.toFixed(6);

			userMarker.setLatLng([lat, lng]);
			map.setView([lat, lng], 14);
		}

		// Location detection
		document.getElementById('detectLocation').addEventListener('click', function () {
			if (navigator.geolocation) {
				document.getElementById('detectLocation').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Detecting...';

				navigator.geolocation.getCurrentPosition(
					function (position) {
						const lat = position.coords.latitude;
						const lng = position.coords.longitude;

						updateUserCoordinates(lat, lng);
						document.getElementById('locationDisplay').value = `Lat: ${lat.toFixed(6)}, Lng: ${lng.toFixed(6)}`;
						document.getElementById('detectLocation').innerHTML = '<i class="fas fa-location-crosshairs"></i> Detect Location';

						// Reverse geocode to get address (simulated for demo)
						const cities = ['Mumbai', 'Delhi', 'Bangalore', 'Chennai', 'Kolkata', 'Hyderabad', 'Pune', 'Ahmedabad'];
						const randomCity = cities[Math.floor(Math.random() * cities.length)];
						document.getElementById('deliveryAddress').value = `Near ${randomCity} Station, ${randomCity}, India`;

						showNotification('Location detected successfully!', 'success');
					},
					function (error) {
						console.error('Error getting location:', error);
						document.getElementById('detectLocation').innerHTML = '<i class="fas fa-location-crosshairs"></i> Detect Location';
						showNotification('Unable to detect location. Please enter manually.', 'error');
					}
				);
			} else {
				showNotification('Geolocation is not supported by your browser', 'error');
			}
		});

		// Use default location
		document.getElementById('useDefaultLocation').addEventListener('click', function () {
			updateUserCoordinates(defaultLat, defaultLng);
			document.getElementById('locationDisplay').value = `Lat: ${defaultLat}, Lng: ${defaultLng}`;
			document.getElementById('deliveryAddress').value = 'Mumbai Central, Mumbai, Maharashtra';
			showNotification('Default location set to Mumbai', 'info');
		});

		// Fuel type selection
		document.querySelectorAll('.fuel-option').forEach(option => {
			option.addEventListener('click', function () {
				document.querySelectorAll('.fuel-option').forEach(opt => {
					opt.classList.remove('selected');
				});
				this.classList.add('selected');

				const fuelType = this.dataset.type;
				updateEstimatedCost();
			});
		});

		// Quantity slider
		const quantitySlider = document.getElementById('quantitySlider');
		const quantityValue = document.getElementById('quantityValue');

		quantitySlider.addEventListener('input', function () {
			quantityValue.textContent = this.value;
			updateEstimatedCost();
		});

		// Update estimated cost
		function updateEstimatedCost() {
			const selectedFuel = document.querySelector('.fuel-option.selected');
			if (!selectedFuel) return;

			const fuelType = selectedFuel.dataset.type;
			const quantity = parseFloat(quantitySlider.value);

			// Get price based on fuel type
			let pricePerUnit = 0;
			switch (fuelType) {
				case 'Petrol': pricePerUnit = 96.72; break;
				case 'Diesel': pricePerUnit = 89.62; break;
				case 'CNG': pricePerUnit = 78.50; break;
				case 'Premium Petrol': pricePerUnit = 105.30; break;
				default: pricePerUnit = 0;
			}

			const baseCost = pricePerUnit * quantity;
			const deliveryCharge = quantity >= 10 ? 0 : 30;
			const tax = baseCost * 0.18; // 18% GST
			const total = baseCost + deliveryCharge + tax;

			document.getElementById('estimatedCost').textContent = total.toFixed(2);
		}

		// Find nearby pumps - REAL AJAX CALL to backend
		document.getElementById('findPumpsBtn').addEventListener('click', function () {
			const selectedFuel = document.querySelector('.fuel-option.selected');
			if (!selectedFuel) {
				showNotification('Please select a fuel type first', 'error');
				return;
			}

			const fuelType = selectedFuel.dataset.type;
			const lat = parseFloat(document.getElementById('userLat').value);
			const lng = parseFloat(document.getElementById('userLng').value);

			if (isNaN(lat) || isNaN(lng)) {
				showNotification('User location not detected', 'error');
				return;
			}

			// Show loading
			document.getElementById('searchResults').style.display = 'block';
			document.getElementById('resultsLoading').style.display = 'block';
			document.getElementById('pumpCards').innerHTML = '';
			document.getElementById('noResults').style.display = 'none';

			// REAL AJAX CALL to your Spring Boot endpoint
			fetch(`/nearby-pumps?lat=${lat}&lng=${lng}&fuelType=${encodeURIComponent(fuelType)}`)
				.then(response => {
					if (!response.ok) {
						throw new Error(`HTTP error! status: ${response.status}`);
					}
					return response.json();
				})
				.then(pumps => {
					console.log('Received pumps from backend:', pumps);
					
					document.getElementById('resultsLoading').style.display = 'none';

					// Clear existing pump markers
					pumpMarkers.forEach(marker => map.removeLayer(marker));
					pumpMarkers = [];

					if (!pumps || pumps.length === 0) {
						document.getElementById('noResults').style.display = 'block';
						showNotification('No petrol pumps found within 20 KM', 'info');
						return;
					}

					// Add pump markers to map
					pumps.forEach(pump => {
						// Make sure pump has required properties
						const pumpLat = pump.latitude || pump.lat;
						const pumpLng = pump.longitude || pump.lng;
						
						if (pumpLat && pumpLng) {
							const pumpMarker = L.marker([pumpLat, pumpLng], {
								icon: L.divIcon({
									html: '<div style="background:#e74c3c;width:16px;height:16px;border-radius:50%;border:2px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.5);"></div>',
									iconSize: [20, 20]
								})
							}).addTo(map);

							pumpMarker.bindPopup(`
								<b>${pump.name || 'Petrol Pump'}</b><br>
								${pump.distance ? `Distance: ${pump.distance.toFixed(2)} km<br>` : ''}
								${pump.rating ? `Rating: ${pump.rating}★<br>` : ''}
								<button onclick="selectPumpForBooking('${pump.id}')"
									style="margin-top:5px;padding:5px 10px;background:#3498db;color:white;border:none;border-radius:3px;cursor:pointer;">
									Book Now
								</button>
							`);

							pumpMarkers.push(pumpMarker);
						}
					});

					// Display pump cards
					displayPumpCards(pumps);

					showNotification(`Found ${pumps.length} pumps nearby`, 'success');
				})
				.catch(error => {
					console.error('Error fetching nearby pumps:', error);
					document.getElementById('resultsLoading').style.display = 'none';
					showNotification('Failed to fetch nearby pumps. Please try again.', 'error');
					
					// Fallback to simulated data for demo purposes
					showSimulatedPumps();
				});
		});

		// Fallback function with simulated data
		function showSimulatedPumps() {
			const simulatedPumps = [
				{
					id: 1,
					name: "Green Fuel Station",
					distance: 2.5,
					latitude: 19.0780,
					longitude: 72.8797,
					address: "123 Main Street, Mumbai",
					rating: 4.5,
					petrolPrice: 96.72,
					dieselPrice: 89.62
				},
				{
					id: 2,
					name: "City Fuel Center",
					distance: 3.2,
					latitude: 19.0740,
					longitude: 72.8757,
					address: "456 Park Avenue, Mumbai",
					rating: 4.2,
					petrolPrice: 97.10,
					dieselPrice: 89.90
				}
			];
			
			// Clear existing pump markers
			pumpMarkers.forEach(marker => map.removeLayer(marker));
			pumpMarkers = [];

			// Add pump markers to map
			simulatedPumps.forEach(pump => {
				const pumpMarker = L.marker([pump.latitude, pump.longitude], {
					icon: L.divIcon({
						html: '<div style="background:#e74c3c;width:16px;height:16px;border-radius:50%;border:2px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.5);"></div>',
						iconSize: [20, 20]
					})
				}).addTo(map);

				pumpMarker.bindPopup(`
					<b>${pump.name}</b><br>
					Distance: ${pump.distance.toFixed(2)} km<br>
					Rating: ${pump.rating}★<br>
					<button onclick="selectPumpForBooking('${pump.id}')"
						style="margin-top:5px;padding:5px 10px;background:#3498db;color:white;border:none;border-radius:3px;cursor:pointer;">
						Book Now
					</button>
				`);

				pumpMarkers.push(pumpMarker);
			});

			// Display pump cards
			displayPumpCards(simulatedPumps);
			showNotification('Showing demo pumps. Backend connection failed.', 'warning');
		}

		// Display pump cards
		function displayPumpCards(pumps) {
			let html = '';

			pumps.forEach(pump => {
				// Extract properties with fallbacks
				const pumpId = pump.id || pump.pumpId;
				const pumpName = pump.name || pump.pumpName || 'Petrol Pump';
				const distance = pump.distance ? pump.distance.toFixed(2) : 'N/A';
				const address = pump.address || pump.location || 'Address not available';
				const rating = pump.rating || pump.ratingValue || 'N/A';
				const petrolPrice = pump.petrolPrice || pump.petrolPricePerLiter || 96.72;
				const dieselPrice = pump.dieselPrice || pump.dieselPricePerLiter || 89.62;

				html += `
					<div class="pump-card">
						<div class="pump-header">
							<div class="pump-name">${pumpName}</div>
							<div class="pump-distance">${distance} km away</div>
						</div>
						
						<div class="pump-details">
							<div class="pump-detail">
								<i class="fas fa-map-marker-alt"></i>
								${address}
							</div>
							<div class="pump-detail">
								<i class="fas fa-star"></i>
								Rating: ${rating}★
							</div>
						</div>
						
						<div class="pump-price">
							Petrol: ₹${petrolPrice}/L | Diesel: ₹${dieselPrice}/L
						</div>
						
						<button class="btn" onclick="selectPumpForBooking('${pumpId}')" 
								style="background: var(--accent); color: white; width: 100%;">
							<i class="fas fa-bolt"></i> Book Now
						</button>
					</div>
				`;
			});

			document.getElementById('pumpCards').innerHTML = html;
		}

		// Select pump for booking
		async function selectPumpForBooking(pumpId) {
			try {
				// You might want to fetch the specific pump details from backend
				// For now, we'll use the pump from the existing list
				const pumps = await fetch(`/nearby-pumps?lat=${document.getElementById('userLat').value}&lng=${document.getElementById('userLng').value}`)
					.then(res => res.json())
					.catch(() => []);
				
				let selectedPump = pumps.find(pump => (pump.id || pump.pumpId) == pumpId);
				
				// If not found in recent search, use a default
				if (!selectedPump) {
					selectedPump = {
						id: pumpId,
						name: "Petrol Pump " + pumpId,
						distance: 3.0,
						address: "Location details not available"
					};
				}

				const selectedFuel = document.querySelector('.fuel-option.selected');
				if (!selectedFuel) {
					showNotification('Please select a fuel type first', 'error');
					return;
				}

				const fuelType = selectedFuel.dataset.type;
				const quantity = quantitySlider.value;
				const vehicleNumber = document.getElementById('vehicleNumber').value;
				const deliveryTime = document.getElementById('deliveryTime').value;
				const deliveryAddress = document.getElementById('deliveryAddress').value;
				const paymentMethod = document.querySelector('input[name="payment"]:checked').value;

				// Validate form
				if (!vehicleNumber || !deliveryTime || !deliveryAddress) {
					showNotification('Please fill all required fields', 'error');
					return;
				}

				// Show booking modal
				document.getElementById('bookingModal').classList.add('active');

				// Populate booking summary
				document.getElementById('bookingSummary').innerHTML = `
					<div style="margin-bottom: 20px;">
						<h4 style="color: var(--primary); margin-bottom: 15px;">
							<i class="fas fa-receipt"></i> Order Summary
						</h4>
						<table style="width: 100%;">
							<tr>
								<td style="padding: 8px 0; color: #666;">Petrol Pump:</td>
								<td style="padding: 8px 0; font-weight: 600;">${selectedPump.name || selectedPump.pumpName}</td>
							</tr>
							<tr>
								<td style="padding: 8px 0; color: #666;">Distance:</td>
								<td style="padding: 8px 0;">${selectedPump.distance ? selectedPump.distance.toFixed(2) + ' km' : 'N/A'}</td>
							</tr>
							<tr>
								<td style="padding: 8px 0; color: #666;">Address:</td>
								<td style="padding: 8px 0;">${selectedPump.address || selectedPump.location || 'Address not available'}</td>
							</tr>
							<tr>
								<td style="padding: 8px 0; color: #666;">Fuel Type:</td>
								<td style="padding: 8px 0;">${fuelType}</td>
							</tr>
							<tr>
								<td style="padding: 8px 0; color: #666;">Quantity:</td>
								<td style="padding: 8px 0;">${quantity}L</td>
							</tr>
							<tr>
								<td style="padding: 8px 0; color: #666;">Vehicle Number:</td>
								<td style="padding: 8px 0;">${vehicleNumber}</td>
							</tr>
							<tr>
								<td style="padding: 8px 0; color: #666;">Delivery Time:</td>
								<td style="padding: 8px 0;">${deliveryTime}</td>
							</tr>
							<tr>
								<td style="padding: 8px 0; color: #666;">Delivery Address:</td>
								<td style="padding: 8px 0;">${deliveryAddress}</td>
							</tr>
							<tr>
								<td style="padding: 8px 0; color: #666;">Payment Method:</td>
								<td style="padding: 8px 0;">${getPaymentMethodName(paymentMethod)}</td>
							</tr>
							<tr style="border-top: 2px solid #eee;">
								<td style="padding: 12px 0; font-weight: 600; color: var(--primary);">Total Amount:</td>
								<td style="padding: 12px 0; font-weight: 700; font-size: 20px; color: var(--accent);">
									₹${document.getElementById('estimatedCost').textContent}
								</td>
							</tr>
						</table>
					</div>
				`;

				// Store booking data for later use
				window.currentBookingData = {
					pumpId: selectedPump.id || selectedPump.pumpId,
					pumpName: selectedPump.name || selectedPump.pumpName,
					fuelType: fuelType,
					quantity: quantity,
					vehicleNumber: vehicleNumber,
					deliveryTime: deliveryTime,
					deliveryAddress: deliveryAddress,
					paymentMethod: paymentMethod,
					totalAmount: document.getElementById('estimatedCost').textContent,
					userLat: document.getElementById('userLat').value,
					userLng: document.getElementById('userLng').value,
					pumpAddress: selectedPump.address || selectedPump.location,
					pumpDistance: selectedPump.distance
				};
				
			} catch (error) {
				console.error('Error selecting pump:', error);
				showNotification('Error loading pump details. Please try again.', 'error');
			}
		}

		function getPaymentMethodName(method) {
			switch(method) {
				case 'online': return 'Online Payment';
				case 'cod': return 'Cash on Delivery';
				case 'wallet': return 'Fuel Express Wallet';
				default: return method;
			}
		}

		// Confirm booking and redirect to payment page
		document.getElementById('confirmBooking').addEventListener('click', function() {
			if (!window.currentBookingData) {
				showNotification('Booking data not found', 'error');
				return;
			}

			// Store booking data in localStorage to pass to payment page
			localStorage.setItem('bookingData', JSON.stringify(window.currentBookingData));

			// Redirect to payment page (Thymeleaf template)
			window.location.href = '/payment';
		});

		// Cancel booking
		document.getElementById('cancelBooking').addEventListener('click', function () {
			document.getElementById('bookingModal').classList.remove('active');
			window.currentBookingData = null;
		});

		// Initialize estimated cost
		updateEstimatedCost();

		// Sidebar toggle functionality
		const toggleSidebar = document.getElementById('toggleSidebar');
		const sidebar = document.getElementById('sidebar');
		const mainContent = document.getElementById('mainContent');
		const sidebarOverlay = document.getElementById('sidebarOverlay');

		toggleSidebar.addEventListener('click', function (e) {
			e.stopPropagation();
			sidebar.classList.toggle('active');
			sidebarOverlay.classList.toggle('active');
			mainContent.classList.toggle('expanded');
		});

		// Close sidebar when clicking overlay
		sidebarOverlay.addEventListener('click', function() {
			sidebar.classList.remove('active');
			sidebarOverlay.classList.remove('active');
			mainContent.classList.remove('expanded');
		});

		// Notification function
		function showNotification(message, type) {
			// Create notification element
			const notification = document.createElement('div');
			notification.style.cssText = `
				position: fixed;
				top: 20px;
				right: 20px;
				padding: 15px 20px;
				border-radius: 8px;
				color: white;
				font-weight: 600;
				z-index: 10000;
				box-shadow: 0 4px 12px rgba(0,0,0,0.15);
				animation: slideIn 0.3s ease;
			`;

			// Set color based on type
			switch(type) {
				case 'success':
					notification.style.background = 'linear-gradient(45deg, #2ecc71, #27ae60)';
					break;
				case 'error':
					notification.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
					break;
				case 'info':
					notification.style.background = 'linear-gradient(45deg, #3498db, #2980b9)';
					break;
				default:
					notification.style.background = 'linear-gradient(45deg, #3498db, #2980b9)';
			}

			notification.innerHTML = `
				<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
				${message}
			`;

			document.body.appendChild(notification);

			// Remove notification after 3 seconds
			setTimeout(() => {
				notification.style.animation = 'slideOut 0.3s ease';
				setTimeout(() => {
					if (notification.parentNode) {
						document.body.removeChild(notification);
					}
				}, 300);
			}, 3000);
		}

		// Add CSS animations for notifications
		const style = document.createElement('style');
		style.textContent = `
			@keyframes slideIn {
				from { transform: translateX(100%); opacity: 0; }
				to { transform: translateX(0); opacity: 1; }
			}
			@keyframes slideOut {
				from { transform: translateX(0); opacity: 1; }
				to { transform: translateX(100%); opacity: 0; }
			}
		`;
		document.head.appendChild(style);

		// Select first fuel option by default
		document.querySelector('.fuel-option').click();
	</script>
</body>
</html>